<!-- DbSSTUDIO-Showroom.v1.2.html -->
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DbSSTUDIO Showroom v1.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* [DbSSTUDIO - Minimalist Aesthetics] */
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            -webkit-font-smoothing: antialiased; 
            background-color: #111; 
            color: #111; 
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center; 
            align-items: flex-start;
        }
        
        .app-container {
            width: 100%;
            max-width: 480px; 
            height: 100vh; 
            background-color: #ffffff;
            position: relative;
            box-shadow: 0 0 60px rgba(0,0,0,0.6);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 80px; 
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .content-area::-webkit-scrollbar { display: none; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fade-in 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

        .ghost-canvas-container {
            position: relative;
            width: 100%;
            aspect-ratio: 4 / 5; 
            background-color: #f9fafb;
            overflow: hidden;
            border-bottom: 1px solid #f0f0f0;
        }

        .ghost-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain; 
            object-position: bottom center;
            pointer-events: none;
            transition: opacity 0.3s ease-in-out;
            will-change: transform, opacity; 
        }

        /* Floating Control Stack */
        .floating-controls {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-40%); 
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 50;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
            border-radius: 99px; 
            padding: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border: 1px solid rgba(255,255,255,0.5);
        }

        .mini-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            color: #9ca3af;
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
            cursor: pointer;
            margin-bottom: 2px;
        }
        .mini-btn:last-child { margin-bottom: 0; }
        
        .mini-btn.active {
            background-color: #000;
            color: #fff;
            transform: scale(1.05);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Dense Card */
        .dense-card {
            aspect-ratio: 1/1;
            position: relative;
            background: #fff;
            border-radius: 0.75rem;
            border: 1px solid #f3f4f6;
            overflow: hidden; 
            display: flex;
            align-items: center;
            justify-content: center;
            transition: border-color 0.2s;
            padding: 0; 
        }
        .dense-card:active { transform: scale(0.98); }
        .dense-card img { width: 100%; height: 100%; object-fit: contain; padding: 2px; }

        /* Warehouse UI */
        .warehouse-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            padding-bottom: 2rem;
        }

        .cat-pill {
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
            transition: all 0.2s;
            border: 1px solid #eee;
            cursor: pointer;
        }
        .cat-pill.active { background-color: #000; color: #fff; border-color: #000; }
        .cat-pill.inactive { background-color: #fff; color: #666; }

        /* Bottom Navigation */
        .bottom-nav {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-around;
            padding: 12px 0 24px 0; 
            z-index: 50;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            font-weight: 600;
            color: #9ca3af;
            cursor: pointer;
            transition: color 0.2s;
            flex: 1;
        }
        .nav-item.active { color: #000; }
        .nav-item:active svg { transform: scale(0.9); }
    </style>
</head>
<body>
    <div id="root" class="w-full flex justify-center"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // --- 1. CORE UTILS: IndexedDB ---
        const DB_CONFIG = { name: 'DbSSTUDIO_Vault_V2', version: 1, store: 'inventory' };
        const dbHelper = {
            open: () => new Promise((resolve, reject) => {
                const req = indexedDB.open(DB_CONFIG.name, DB_CONFIG.version);
                req.onupgradeneeded = (e) => {
                    const db = e.target.result;
                    if (!db.objectStoreNames.contains(DB_CONFIG.store)) db.createObjectStore(DB_CONFIG.store, { keyPath: 'id', autoIncrement: true });
                };
                req.onsuccess = () => resolve(req.result);
                req.onerror = () => reject(req.error);
            }),
            addItem: async (item) => {
                const db = await dbHelper.open();
                return new Promise((resolve, reject) => {
                    const tx = db.transaction(DB_CONFIG.store, 'readwrite');
                    const req = tx.objectStore(DB_CONFIG.store).add(item);
                    req.onsuccess = () => resolve({ ...item, id: req.result });
                    req.onerror = () => reject(req.error);
                });
            },
            getAllItems: async () => {
                const db = await dbHelper.open();
                return new Promise((resolve, reject) => {
                    const tx = db.transaction(DB_CONFIG.store, 'readonly');
                    const req = tx.objectStore(DB_CONFIG.store).getAll();
                    req.onsuccess = () => resolve(req.result);
                    req.onerror = () => reject(req.error);
                });
            },
            deleteItem: async (id) => {
                const db = await dbHelper.open();
                return new Promise((resolve, reject) => {
                    const tx = db.transaction(DB_CONFIG.store, 'readwrite');
                    const req = tx.objectStore(DB_CONFIG.store).delete(id);
                    req.onsuccess = () => resolve();
                    req.onerror = () => reject(req.error);
                });
            }
        };

        // --- 2. CONFIGURATION (DbS v1.2) ---
        const MASTER_CATEGORIES = {
            short_t: ['短T'], long_t: ['長T'], sweatshirt: ['衛衣'], bottom: ['下身'], shoes: ['鞋款']
        };

        const SLOTS = [
            { id: 'short_t', label: '短T' }, { id: 'long_t', label: '長T' }, { id: 'sweatshirt', label: '衛衣' },
            { id: 'bottom', label: '下身' }, { id: 'shoes', label: '鞋款' }
        ];

        const INVENTORY_TABS = SLOTS.map(s => ({ id: s.id, label: s.label, slots: [s.id] }));
        
        const DEFAULT_OUTFIT = { short_t: null, long_t: null, sweatshirt: null, bottom: null, shoes: null };

        const OCCASIONS = [ { id: 'Formal', label: '正式' }, { id: 'Smart', label: '大人' }, { id: 'Casual', label: '休閒' } ];
        const SEASONS = [ { id: 'Winter', label: '冬季' }, { id: 'Summer', label: '夏季' } ];

        const BASE_COLORS = [
            { id: 'black', hex: '#1A1A1A', name: '黑' }, { id: 'white', hex: '#FFFFFF', name: '白', border: true },
            { id: 'gray', hex: '#808080', name: '灰' }, { id: 'navy', hex: '#1E3A8A', name: '深藍' }, { id: 'beige', hex: '#C3B091', name: '大地' }
        ];
        const SPECIAL_COLORS = [
            { id: 'burgundy', hex: '#991b1b', name: '酒紅' }, { id: 'green', hex: '#008000', name: '鮮綠' }, { id: 'denim', hex: '#3B82F6', name: '丹寧' }
        ];

        // --- 3. ICONS ---
        const Icon = ({ name, className }) => {
            const i = {
                hanger: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 2a5 5 0 0 1 4.9 6H7.1a5 5 0 0 1 4.9-6Z"/><path d="M21 21H3V11c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2v10Z"/></svg>,
                grid: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>,
                plus: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 5v14M5 12h14"/></svg>,
                trash: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
                dice: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="8" cy="8" r="1.5" fill="currentColor"/><circle cx="16" cy="16" r="1.5" fill="currentColor"/><circle cx="8" cy="16" r="1.5" fill="currentColor"/><circle cx="16" cy="8" r="1.5" fill="currentColor"/></svg>,
                x: <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            };
            return i[name] ? React.cloneElement(i[name], { className }) : null;
        };

        // --- 4. GHOST ENGINE ---
        const GhostEngine = ({ outfit, occasion, setOccasion, season, setSeason, triggerRandom, onGoToWarehouse }) => {
            const { short_t, long_t, sweatshirt, bottom, shoes } = outfit;
            return (
                <div className="w-full flex justify-center items-center animate-fade-in bg-white relative">
                    <div className="ghost-canvas-container mx-auto relative">
                        {shoes && <img src={shoes.image} className="ghost-layer z-10" alt="Shoes" style={{ transform: 'translateZ(0)' }} />}
                        {bottom && <img src={bottom.image} className="ghost-layer z-20" alt="Bottom" />}
                        {short_t && <img src={short_t.image} className="ghost-layer z-30" alt="ShortT" />}
                        {long_t && <img src={long_t.image} className="ghost-layer z-[35]" alt="LongT" />}
                        {sweatshirt && <img src={sweatshirt.image} className="ghost-layer z-40" alt="Sweatshirt" />}
                        
                        {(!shoes && !bottom && !short_t && !long_t && !sweatshirt) && (
                            <div className="absolute inset-0 flex flex-col items-center justify-center z-20 pointer-events-auto">
                                <p className="text-gray-300 text-xs tracking-widest mb-4">SHOWROOM 為空</p>
                                <button onClick={onGoToWarehouse} className="px-4 py-2 bg-black text-white text-xs font-bold rounded-full shadow-lg hover:scale-105 transition-transform">
                                    + 匯入單品
                                </button>
                            </div>
                        )}
                    </div>

                    <div className="floating-controls">
                        <div className="control-group mb-3">
                            {SEASONS.map(s => (
                                <button key={s.id} className={`mini-btn ${season === s.id ? 'active' : ''}`} onClick={() => { setSeason(s.id); triggerRandom(occasion, s.id); }}>{s.label.slice(0, 1)}</button>
                            ))}
                        </div>
                        <div className="control-group">
                            {OCCASIONS.map(occ => (
                                <button key={occ.id} className={`mini-btn ${occasion === occ.id ? 'active' : ''}`} onClick={() => { setOccasion(occ.id); triggerRandom(occ.id, season); }}>{occ.label.slice(0, 2)}</button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // --- 5. APP COMPONENT ---
        const App = () => {
            const [wardrobe, setWardrobe] = useState([]);
            const [outfit, setOutfit] = useState(DEFAULT_OUTFIT);
            const [activeTab, setActiveTab] = useState('styling');
            
            // Warehouse State
            const [whSlot, setWhSlot] = useState('short_t');
            const [whColor, setWhColor] = useState('black');
            const [whUrl, setWhUrl] = useState(''); // New GitHub/URL Input

            // Load from DB
            const loadData = async () => {
                try {
                    const items = await dbHelper.getAllItems();
                    setWardrobe(items);
                } catch (e) { console.error("DB Error", e); }
            };
            useEffect(() => { loadData(); }, []);

            // New Import Logic
            const handleImport = async () => {
                if (!whUrl) return alert("請輸入圖片網址 (GitHub Raw / Imgur)");
                
                const newItem = {
                    slot: whSlot,
                    image: whUrl,
                    color: whColor,
                    category: MASTER_CATEGORIES[whSlot][0],
                    createdAt: Date.now()
                };

                try {
                    await dbHelper.addItem(newItem);
                    await loadData();
                    setWhUrl(''); // Clear input
                    alert("單品已匯入成功！");
                } catch (e) {
                    alert("匯入失敗");
                }
            };

            const handleDeleteItem = async (id) => {
                if(!confirm("移除此單品？")) return;
                await dbHelper.deleteItem(id);
                loadData();
                setOutfit(prev => {
                    const next = { ...prev };
                    Object.keys(next).forEach(k => { if (next[k]?.id === id) next[k] = null; });
                    return next;
                });
            };

            const handleClearSlot = (slot) => setOutfit(prev => ({ ...prev, [slot]: null }));
            const handleClearAll = () => setOutfit(DEFAULT_OUTFIT);

            const handleRandom = useCallback((targetOccasion, targetSeason) => {
                const newOutfit = { ...outfit };
                SLOTS.forEach(s => {
                    const candidates = wardrobe.filter(item => item.slot === s.id);
                    // Simple logic: if summer, no sweatshirts
                    if (targetSeason === 'Summer' && s.id === 'sweatshirt') {
                        newOutfit[s.id] = null;
                        return;
                    }
                    if (candidates.length > 0) newOutfit[s.id] = candidates[Math.floor(Math.random() * candidates.length)];
                });
                setOutfit(newOutfit);
            }, [outfit, wardrobe]);

            return (
                <div className="app-container">
                    <div className="px-6 pt-6 pb-2 bg-white border-b border-gray-100 flex justify-between items-center z-10 sticky top-0">
                        <h1 className="text-lg font-bold tracking-tighter flex items-center gap-2">
                            DbSSTUDIO 
                            <span className="bg-black text-white text-[10px] px-2 py-0.5 rounded-full shadow-sm">v1.2</span>
                        </h1>
                    </div>

                    <div className="content-area bg-gray-50">
                        {/* TAB 1: STYLING */}
                        {activeTab === 'styling' && (
                            <div className="animate-fade-in">
                                <GhostEngine 
                                    outfit={outfit} 
                                    occasion='Smart' setOccasion={()=>{}}
                                    season='Winter' setSeason={()=>{}}
                                    triggerRandom={handleRandom}
                                    onGoToWarehouse={() => setActiveTab('add')}
                                />
                                
                                <div className="px-6 mt-4 mb-4">
                                    <div className="grid grid-cols-5 gap-2 mb-4">
                                        {SLOTS.map(s => (
                                            <div key={s.id} className="relative group">
                                                <div className={`aspect-square rounded-xl border flex flex-col items-center justify-center cursor-pointer transition-all overflow-hidden relative ${outfit[s.id] ? 'bg-white border-black' : 'bg-gray-100 border-dashed border-gray-300'}`}>
                                                    {outfit[s.id] ? (
                                                        <div className={`w-full h-full overflow-hidden ${s.id === 'shoes' ? '' : 'p-1'}`}>
                                                            <img 
                                                                src={outfit[s.id].image} 
                                                                className="w-full h-full object-contain"
                                                                style={s.id === 'shoes' ? { transform: 'scale(3.8) translateZ(0)', transformOrigin: 'bottom center' } : {}}
                                                            />
                                                        </div>
                                                    ) : (
                                                        <span className="text-[8px] font-bold text-gray-400">{s.label}</span>
                                                    )}
                                                </div>
                                                {outfit[s.id] && (
                                                    <button onClick={() => handleClearSlot(s.id)} className="absolute -top-2 -right-2 bg-white border border-gray-200 text-gray-400 rounded-full p-1 shadow hover:text-red-500 z-20"><Icon name="x" className="w-2 h-2" /></button>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                    <div className="flex gap-3">
                                        <button onClick={handleClearAll} className="flex-1 py-3 bg-white border border-gray-200 text-gray-500 text-xs font-bold tracking-widest uppercase rounded-xl hover:bg-gray-50 flex items-center justify-center gap-2 active:scale-95 transition-transform"><Icon name="trash" className="w-4 h-4" /> 重置</button>
                                        <button onClick={() => handleRandom('Smart', 'Winter')} className="flex-[2] py-3 bg-black text-white text-xs font-bold tracking-widest uppercase rounded-xl hover:bg-gray-900 shadow-lg flex items-center justify-center gap-2 transition-transform active:scale-95"><Icon name="dice" className="w-4 h-4" /> 智慧搭配</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* TAB 2: CLOSET */}
                        {activeTab === 'closet' && (
                            <div className="p-6 animate-fade-in min-h-full bg-white">
                                <h2 className="text-xl font-bold mb-4">我的收藏</h2>
                                <div className="flex gap-2 mb-6 overflow-x-auto no-scrollbar">
                                    {INVENTORY_TABS.map(tab => (
                                        <button key={tab.id} onClick={() => setWhSlot(tab.id)} className={`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap transition-colors ${whSlot === tab.id ? 'bg-black text-white' : 'bg-gray-100 text-gray-400'}`}>{tab.label}</button>
                                    ))}
                                </div>
                                <div className="grid grid-cols-3 gap-2">
                                    {wardrobe.filter(item => item.slot === whSlot).map(item => (
                                        <div key={item.id} onClick={() => { setOutfit(prev => ({...prev, [item.slot]: item})); setActiveTab('styling'); }} className="dense-card cursor-pointer overflow-hidden relative group">
                                            <img src={item.image} className="w-full h-full object-contain" style={item.slot === 'shoes' ? { transform: 'scale(3.5)', transformOrigin: 'bottom center' } : {}} />
                                            <div className="absolute bottom-1 right-1 w-2 h-2 rounded-full border border-gray-100 shadow-sm" style={{ background: [...BASE_COLORS, ...SPECIAL_COLORS].find(c => c.id === item.color)?.hex || '#000' }}></div>
                                            <button onClick={(e) => { e.stopPropagation(); handleDeleteItem(item.id); }} className="absolute top-1 right-1 p-1 bg-white/80 rounded-full text-gray-300 hover:text-red-500"><Icon name="trash" className="w-3 h-3" /></button>
                                        </div>
                                    ))}
                                </div>
                                {wardrobe.length === 0 && <div className="text-center py-12 text-gray-300 text-xs">暫無單品，請至倉庫匯入</div>}
                            </div>
                        )}

                        {/* TAB 3: WAREHOUSE (IMPORT) */}
                        {activeTab === 'add' && (
                            <div className="p-6 animate-fade-in bg-white min-h-full">
                                <h2 className="text-xl font-bold mb-4">單品倉庫 (GH Import)</h2>
                                
                                <div className="mb-6">
                                    <label className="text-xs font-bold text-gray-400 mb-2 block uppercase tracking-wider">選擇分類</label>
                                    <div className="flex gap-2 overflow-x-auto no-scrollbar pb-1">
                                        {SLOTS.map(s => (
                                            <button key={s.id} onClick={() => setWhSlot(s.id)} className={`px-4 py-2 rounded-lg text-xs font-bold whitespace-nowrap border transition-colors ${whSlot === s.id ? 'bg-black text-white border-black' : 'bg-white text-gray-500 border-gray-200'}`}>{s.label}</button>
                                        ))}
                                    </div>
                                </div>

                                <div className="mb-6">
                                    <label className="text-xs font-bold text-gray-400 mb-2 block uppercase tracking-wider">選擇色系</label>
                                    <div className="flex gap-3 overflow-x-auto no-scrollbar py-1">
                                        {[...BASE_COLORS, ...SPECIAL_COLORS].map(c => (
                                            <div key={c.id} className="flex flex-col items-center gap-1 cursor-pointer flex-shrink-0" onClick={() => setWhColor(c.id)}>
                                                <div className={`w-8 h-8 rounded-full transition-all shadow-sm ${whColor === c.id ? 'ring-2 ring-offset-2 ring-black scale-110' : 'hover:scale-105'}`} style={{ background: c.hex, border: c.border ? '1px solid #e5e7eb' : 'none' }}></div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="mb-8">
                                    <label className="text-xs font-bold text-gray-400 mb-2 block uppercase tracking-wider">圖片網址 (URL)</label>
                                    <input 
                                        type="text" 
                                        value={whUrl}
                                        onChange={(e) => setWhUrl(e.target.value)}
                                        placeholder="貼上 GitHub Raw 或 圖床連結..."
                                        className="w-full p-4 bg-gray-50 border border-gray-200 rounded-xl text-xs focus:outline-none focus:border-black transition-colors font-mono text-gray-600"
                                    />
                                    <p className="text-[10px] text-gray-400 mt-2">提示：使用去背 PNG 圖片效果最佳。</p>
                                </div>

                                <button onClick={handleImport} className="w-full py-4 bg-black text-white text-sm font-bold rounded-xl shadow-lg hover:scale-[1.02] transition-transform flex items-center justify-center gap-2">
                                    <Icon name="plus" className="w-4 h-4" /> 確認入庫
                                </button>
                            </div>
                        )}
                    </div>

                    <div className="bottom-nav">
                         <div onClick={() => setActiveTab('styling')} className={`nav-item ${activeTab === 'styling' ? 'active' : ''}`}>
                            <Icon name="hanger" className="w-6 h-6" />
                            <span>搭配</span>
                        </div>
                        <div onClick={() => setActiveTab('closet')} className={`nav-item ${activeTab === 'closet' ? 'active' : ''}`}>
                            <Icon name="grid" className="w-6 h-6" />
                            <span>衣櫥</span>
                        </div>
                        <div onClick={() => setActiveTab('add')} className={`nav-item ${activeTab === 'add' ? 'active' : ''}`}>
                            <Icon name="plus" className="w-6 h-6" />
                            <span>倉庫</span>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>