<!-- DbSSTUDIO-Showroom.v3.9.html -->
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>DbSSTUDIO v3.9 - Ultimate Archive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* [DbSSTUDIO v3.9 Core Styles] */
        :root {
            --sab: env(safe-area-inset-bottom);
            --sat: env(safe-area-inset-top);
        }
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
            background-color: #f2f2f2; 
            color: #111; 
            margin: 0; 
            height: 100dvh; 
            overflow: hidden; 
            display: flex; 
            justify-content: center;
        }
        .app-container {
            width: 100%; max-width: 480px; height: 100%; 
            background-color: #fff; position: relative;
            box-shadow: 0 0 40px rgba(0,0,0,0.05);
            display: flex; flex-direction: column; overflow: hidden;
        }
        /* Scrollbar Hiding */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Animation */
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade { animation: fade-in 0.3s ease-out forwards; }
        
        /* Grid Layout */
        .catalog-grid {
            display: grid; grid-template-columns: repeat(3, 1fr);
            gap: 1px; background-color: #f0f0f0; padding-bottom: 120px;
        }
        .grid-item {
            background: #fff; aspect-ratio: 3/4; position: relative;
            cursor: pointer; overflow: hidden;
        }
        /* Image Transition */
        .grid-item img {
            width: 100%; height: 100%; object-fit: contain; padding: 8px;
            transition: transform 0.3s ease, opacity 0.2s;
        }
        .grid-item:active img { transform: scale(0.96); }

        /* Ghost Layer for Style */
        .ghost-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: contain; object-position: bottom center;
            pointer-events: none; transition: opacity 0.2s;
        }
        
        /* Sticky Tabs */
        .sticky-tabs {
            position: sticky; top: 0; z-index: 40; background: rgba(255,255,255,0.98);
            border-bottom: 1px solid #eee; display: flex; overflow-x: auto;
        }
        .tab-btn {
            padding: 14px 16px; font-size: 11px; font-weight: 600; color: #999;
            white-space: nowrap; border-bottom: 2px solid transparent; transition: all 0.2s;
        }
        .tab-btn.active { color: #000; border-bottom-color: #000; }

        /* Lightbox & Modal */
        .full-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.99); z-index: 9999;
            display: flex; flex-direction: column; animation: fade-in 0.2s;
        }
        
        /* Nav */
        .bottom-nav {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: rgba(255,255,255,0.96); backdrop-filter: blur(10px);
            border-top: 1px solid #f0f0f0; display: flex; justify-content: space-around;
            padding-bottom: calc(20px + var(--sab)); padding-top: 16px; z-index: 50;
        }
        .nav-icon {
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            color: #ccc; transition: color 0.3s; cursor: pointer;
        }
        .nav-icon.active { color: #000; }
        .nav-text { font-size: 9px; font-weight: 600; letter-spacing: 0.5px; text-transform: uppercase; }

        /* Inquiry Floating Btn */
        .float-cart {
            position: absolute; bottom: 100px; right: 20px;
            width: 44px; height: 44px; background: #000; color: #fff;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15); z-index: 45; cursor: pointer;
            margin-bottom: var(--sab);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Scripts -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- 1. DATA CONFIG (v3.9 Archive) ---
        const LINE_ID = "@dbsstudio";
        
        // Inventory Configuration
        const CONFIG = [
            { id: 'short_t', group: 'Tops', label: '短T', prefix: 'st', count: 20 },
            { id: 'long_t',  group: 'Tops', label: '長T', prefix: 'lt', count: 20 },
            { id: 'sweatshirt', group: 'Tops', label: '衛衣', prefix: 'sw', count: 15 },
            { id: 'bottom',  group: 'Pants', label: '褲裝', prefix: 'b',  count: 30 }, // Unlocked to 30
            { id: 'shoes',   group: 'Shoes', label: '鞋履', prefix: 's',  count: 15 }  // Mixed prefixes
        ];

        const SIZES = ['S', 'M', 'L', 'XL', 'XXL'];

        // --- 2. ICONS ---
        const Icon = ({ name, size=20, className="" }) => {
            const paths = {
                x: <path d="M18 6L6 18M6 6l12 12" />,
                menu: <path d="M3 12h18M3 6h18M3 18h18" />,
                grid: <rect x="3" y="3" width="7" height="7" /><rect x="14" y="3" width="7" height="7" /><rect x="14" y="14" width="7" height="7" /><rect x="3" y="14" width="7" height="7" />,
                hanger: <path d="M12 2a5 5 0 015 5v2h2v12H5V9h2V7a5 5 0 015-5z" />,
                info: <circle cx="12" cy="12" r="10" /><path d="M12 16v-4M12 8h.01" />,
                cart: <path d="M9 20a1 1 0 100-2 1 1 0 000 2zM20 20a1 1 0 100-2 1 1 0 000 2zM1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6" />,
                plus: <path d="M12 5v14M5 12h14" />,
                check: <polyline points="20 6 9 17 4 12" />,
                trash: <polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2" />
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {paths[name] || null}
                </svg>
            );
        };

        // --- 3. SMART IMAGE COMPONENT (v3.9 Priority Logic) ---
        const SmartImage = ({ prefix, index, suffix, className, alt, onClick, style }) => {
            const [src, setSrc] = useState('');
            const [errorStep, setErrorStep] = useState(0);
            const [isHidden, setIsHidden] = useState(false);

            // Path Generators (Priority: 4 digits -> 3 -> 2 -> 1 -> Raw)
            const paths = useMemo(() => {
                const sIndex = String(index);
                return [
                    `./${prefix}${sIndex.padStart(4, '0')}${suffix}`, // b0010
                    `./${prefix}${sIndex.padStart(3, '0')}${suffix}`, // b010
                    `./${prefix}${sIndex.padStart(2, '0')}${suffix}`, // b10
                    `./${prefix}${index}${suffix}`                     // b1
                ];
            }, [prefix, index, suffix]);

            useEffect(() => {
                setSrc(paths[0]);
                setErrorStep(0);
                setIsHidden(false);
            }, [paths]);

            const handleError = () => {
                const nextStep = errorStep + 1;
                if (nextStep < paths.length) {
                    setSrc(paths[nextStep]);
                    setErrorStep(nextStep);
                } else {
                    setIsHidden(true); // Hard Fail: Hide image completely
                }
            };

            if (isHidden) return <div className={className} style={{...style, opacity: 0}} />;

            return (
                <img 
                    src={src} 
                    className={className} 
                    alt={""} // Prevent ugly alt text on broken image
                    onClick={onClick}
                    onError={handleError}
                    style={style}
                />
            );
        };

        // --- 4. MAIN APP ---
        const App = () => {
            const [page, setPage] = useState('catalog'); // catalog, style, info
            const [activeFilter, setActiveFilter] = useState('All');
            const [cart, setCart] = useState([]);
            const [detailItem, setDetailItem] = useState(null);
            const [showCart, setShowCart] = useState(false);
            
            // Style Room State
            const [outfit, setOutfit] = useState({ top: null, pant: null, shoes: null });
            const [styleTab, setStyleTab] = useState('Tops'); // Tops, Pants, Shoes

            // --- DATA GENERATION ---
            const catalog = useMemo(() => {
                let items = [];
                CONFIG.forEach(cfg => {
                    for(let i=1; i<=cfg.count; i++){
                        // Special logic for Shoes prefix mixing
                        let p = cfg.prefix;
                        let rawIdx = i;
                        if(cfg.id === 'shoes'){
                            if(i > 5 && i <= 10) { p = 'w'; rawIdx = i - 5; }
                            if(i > 10) { p = 'x'; rawIdx = i - 10; }
                        }
                        
                        items.push({
                            uid: `${cfg.id}_${i}`,
                            displayId: `${p.toUpperCase()}${String(rawIdx).padStart(3,'0')}`,
                            group: cfg.group,
                            type: cfg.id,
                            rawPrefix: p,
                            rawIndex: rawIdx,
                            name: cfg.label
                        });
                    }
                });
                return items;
            }, []);

            const filteredItems = useMemo(() => {
                if(activeFilter === 'All') return catalog;
                return catalog.filter(i => i.group === activeFilter);
            }, [catalog, activeFilter]);

            // --- CART LOGIC ---
            const addToCart = (item, size) => {
                const newItem = { ...item, size, cartId: Date.now() };
                setCart(prev => [...prev, newItem]);
                setDetailItem(null);
            };

            const removeFromCart = (id) => {
                setCart(prev => prev.filter(i => i.cartId !== id));
            };

            const sendInquiry = () => {
                if(cart.length === 0) return;
                let msg = "您好，我想詢問以下單品庫存：\n\n";
                cart.forEach((c, idx) => {
                    msg += `${idx+1}. ${c.displayId} / 尺寸:${c.size}\n`;
                });
                msg += "\n感謝。";
                window.location.href = `https://line.me/R/oaMessage/${LINE_ID}/?${encodeURIComponent(msg)}`;
            };

            // --- RENDER HELPERS ---
            const renderGhostLayer = (item, z) => (
                <SmartImage 
                    prefix={item.rawPrefix} 
                    index={item.rawIndex} 
                    suffix="_g.png" 
                    className={`ghost-layer z-[${z}]`} 
                />
            );

            return (
                <div className="app-container pt-[var(--sat)]">
                    
                    {/* PAGE 1: CATALOG */}
                    {page === 'catalog' && (
                        <>
                            <div className="flex flex-col items-center pt-6 pb-2 bg-white">
                                <img src="./brand_logo.png" className="w-[180px] object-contain" alt="DbSSTUDIO" />
                                <span className="text-[10px] text-gray-400 tracking-[0.2em] mt-1 uppercase">v3.9 Ultimate Archive</span>
                            </div>

                            <div className="sticky-tabs">
                                {['All', 'Tops', 'Pants', 'Shoes'].map(t => (
                                    <button 
                                        key={t} 
                                        onClick={() => setActiveFilter(t)}
                                        className={`tab-btn ${activeFilter === t ? 'active' : ''}`}
                                    >
                                        {t === 'All' ? '全部' : t === 'Pants' ? '褲裝' : t === 'Shoes' ? '鞋履' : '上衣'}
                                    </button>
                                ))}
                            </div>

                            <div className="flex-1 overflow-y-auto no-scrollbar content-area">
                                <div className="catalog-grid">
                                    {filteredItems.map(item => (
                                        <div key={item.uid} className="grid-item" onClick={() => setDetailItem(item)}>
                                            <SmartImage 
                                                prefix={item.rawPrefix} 
                                                index={item.rawIndex} 
                                                suffix="_d.png" 
                                            />
                                            <div className="absolute bottom-1 right-2 text-[8px] text-gray-400 font-mono">{item.displayId}</div>
                                        </div>
                                    ))}
                                </div>
                                <div className="py-12 text-center text-[10px] text-gray-300">END OF ARCHIVE</div>
                            </div>
                        </>
                    )}

                    {/* PAGE 2: STYLE ROOM */}
                    {page === 'style' && (
                        <div className="flex flex-col h-full bg-white">
                            {/* Preview Area */}
                            <div className="flex-1 relative bg-white overflow-hidden">
                                <div className="absolute inset-0 flex items-center justify-center opacity-10 pointer-events-none">
                                    <span className="text-4xl font-black text-gray-100 tracking-tighter">DbS</span>
                                </div>
                                {/* Layers: Shoes(10), Pant(20), Top(30) */}
                                {outfit.shoes && renderGhostLayer(outfit.shoes, 10)}
                                {outfit.pant && renderGhostLayer(outfit.pant, 20)}
                                {outfit.top && renderGhostLayer(outfit.top, 30)}
                                
                                {(!outfit.shoes && !outfit.pant && !outfit.top) && (
                                    <div className="absolute inset-0 flex items-center justify-center text-gray-300 text-xs tracking-widest">
                                        SELECT ITEM TO PREVIEW
                                    </div>
                                )}
                            </div>

                            {/* Controls */}
                            <div className="h-[220px] bg-white border-t border-gray-100 flex flex-col z-30 pb-[70px]">
                                <div className="flex gap-4 px-4 py-3 border-b border-gray-50 overflow-x-auto no-scrollbar">
                                    {['Tops', 'Pants', 'Shoes'].map(c => (
                                        <button 
                                            key={c}
                                            onClick={() => setStyleTab(c)}
                                            className={`px-4 py-1.5 rounded-full text-[11px] font-bold transition-all ${styleTab===c ? 'bg-black text-white' : 'bg-gray-100 text-gray-500'}`}
                                        >
                                            {c === 'Pants' ? '褲裝' : c === 'Shoes' ? '鞋履' : '上衣'}
                                        </button>
                                    ))}
                                </div>
                                <div className="flex-1 overflow-x-auto no-scrollbar flex items-center px-2 gap-2">
                                    {catalog.filter(i => {
                                        if(styleTab==='Tops') return i.group==='Tops';
                                        if(styleTab==='Pants') return i.group==='Pants';
                                        return i.group==='Shoes';
                                    }).map(item => (
                                        <div 
                                            key={item.uid} 
                                            className="min-w-[70px] h-[90px] border border-gray-100 rounded p-1 cursor-pointer hover:border-black transition-colors flex items-center justify-center relative"
                                            onClick={() => {
                                                const key = styleTab === 'Tops' ? 'top' : styleTab === 'Pants' ? 'pant' : 'shoes';
                                                setOutfit(prev => ({ ...prev, [key]: item }));
                                            }}
                                        >
                                            <SmartImage prefix={item.rawPrefix} index={item.rawIndex} suffix="_d.png" className="w-full h-full object-contain" />
                                            {outfit[styleTab === 'Tops' ? 'top' : styleTab === 'Pants' ? 'pant' : 'shoes']?.uid === item.uid && (
                                                <div className="absolute top-1 right-1 w-2 h-2 bg-black rounded-full"></div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* PAGE 3: INFO */}
                    {page === 'info' && (
                        <div className="h-full flex flex-col items-center justify-center p-8 text-center bg-white">
                            <img src="./brand_logo.png" className="w-[160px] mb-8" alt="Logo" />
                            <div className="w-10 h-[1px] bg-black mb-8"></div>
                            <p className="text-xs font-bold mb-2">DbSSTUDIO Showroom</p>
                            <p className="text-[10px] text-gray-500 tracking-wider mb-8">v3.9 ULTIMATE ARCHIVE</p>
                            <p className="text-xs text-gray-600 leading-7 max-w-[260px]">
                                極簡主義的實踐。<br/>
                                去除多餘裝飾，回歸材質與剪裁的本質。<br/>
                                我們不定義風格，由您定義自己。
                            </p>
                            <div className="mt-12 w-full max-w-[200px]">
                                <button onClick={() => window.location.href=`https://line.me/R/oaMessage/${LINE_ID}/?Hi`} className="w-full bg-[#06C755] text-white py-3 rounded text-xs font-bold">
                                    LINE 官方諮詢
                                </button>
                            </div>
                        </div>
                    )}

                    {/* GLOBAL: Floating Cart */}
                    {cart.length > 0 && !showCart && (
                        <div className="float-cart animate-fade" onClick={() => setShowCart(true)}>
                            <Icon name="cart" size={20} />
                            <div className="absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full text-[9px] flex items-center justify-center font-bold text-white border-2 border-white">{cart.length}</div>
                        </div>
                    )}

                    {/* DETAIL MODAL */}
                    {detailItem && (
                        <DetailView 
                            item={detailItem} 
                            onClose={() => setDetailItem(null)} 
                            onAdd={addToCart} 
                        />
                    )}

                    {/* CART MODAL */}
                    {showCart && (
                        <CartView 
                            list={cart} 
                            onClose={() => setShowCart(false)} 
                            onRemove={removeFromCart} 
                            onSend={sendInquiry} 
                        />
                    )}

                    {/* NAV */}
                    <div className="bottom-nav">
                        <NavBtn icon="grid" label="目錄" active={page==='catalog'} onClick={()=>setPage('catalog')} />
                        <NavBtn icon="hanger" label="搭配" active={page==='style'} onClick={()=>setPage('style')} />
                        <NavBtn icon="info" label="關於" active={page==='info'} onClick={()=>setPage('info')} />
                    </div>

                </div>
            );
        };

        // --- SUB COMPONENTS ---

        const NavBtn = ({ icon, label, active, onClick }) => (
            <div className={`nav-icon ${active ? 'active' : ''}`} onClick={onClick}>
                <Icon name={icon} size={22} strokeWidth={active?2:1.5} />
                <span className="nav-text">{label}</span>
            </div>
        );

        const DetailView = ({ item, onClose, onAdd }) => {
            const [size, setSize] = useState(null);
            
            return (
                <div className="full-modal">
                    <div className="absolute top-0 right-0 p-5 z-50">
                        <button onClick={onClose} className="w-10 h-10 bg-white rounded-full shadow-lg flex items-center justify-center text-black">
                            <Icon name="x" />
                        </button>
                    </div>
                    
                    <div className="flex-1 overflow-y-auto no-scrollbar flex items-center justify-center p-4 bg-gray-50">
                        <SmartImage 
                            prefix={item.rawPrefix} 
                            index={item.rawIndex} 
                            suffix="_d.png" 
                            className="w-full max-w-[90%] h-auto shadow-2xl" 
                            style={{ transform: 'translateY(-20px)' }}
                        />
                    </div>

                    <div className="bg-white p-6 pb-[calc(20px+env(safe-area-inset-bottom))] border-t border-gray-100">
                        <h2 className="text-xl font-bold font-mono mb-1">{item.displayId}</h2>
                        <p className="text-xs text-gray-500 mb-6">{item.name}</p>

                        <div className="flex gap-3 mb-8 justify-center">
                            {SIZES.map(s => (
                                <button 
                                    key={s} 
                                    onClick={() => setSize(s)}
                                    className={`w-10 h-10 rounded-full border flex items-center justify-center text-xs font-medium transition-all ${size===s ? 'bg-black text-white border-black' : 'bg-white text-gray-400 border-gray-200'}`}
                                >
                                    {s}
                                </button>
                            ))}
                        </div>

                        <button 
                            onClick={() => { if(!size) return alert('請選擇尺寸'); onAdd(item, size); }}
                            className="w-full bg-black text-white h-12 rounded flex items-center justify-center gap-2 text-xs font-bold tracking-widest uppercase hover:opacity-90 active:scale-95 transition-all"
                        >
                            <span>加入詢問單</span>
                            <Icon name="plus" size={16} />
                        </button>
                    </div>
                </div>
            );
        };

        const CartView = ({ list, onClose, onRemove, onSend }) => (
            <div className="fixed inset-0 z-[60] bg-black/50 backdrop-blur-sm flex items-end sm:items-center justify-center p-0 sm:p-4 animate-fade" onClick={onClose}>
                <div className="bg-white w-full sm:max-w-[340px] rounded-t-xl sm:rounded-xl overflow-hidden flex flex-col max-h-[80vh]" onClick={e => e.stopPropagation()}>
                    <div className="p-4 border-b border-gray-100 flex justify-between items-center bg-white sticky top-0">
                        <h3 className="font-bold text-sm">詢問清單 ({list.length})</h3>
                        <button onClick={onClose}><Icon name="x" size={20} /></button>
                    </div>
                    
                    <div className="overflow-y-auto p-4 flex-1 bg-gray-50">
                        {list.length === 0 ? (
                            <div className="py-8 text-center text-gray-400 text-xs">清單是空的</div>
                        ) : (
                            <div className="space-y-3">
                                {list.map(item => (
                                    <div key={item.cartId} className="bg-white p-3 rounded shadow-sm flex items-center gap-3">
                                        <div className="w-12 h-12 bg-gray-100 rounded overflow-hidden flex-shrink-0">
                                            <SmartImage prefix={item.rawPrefix} index={item.rawIndex} suffix="_d.png" className="w-full h-full object-contain" />
                                        </div>
                                        <div className="flex-1">
                                            <div className="font-mono text-xs font-bold">{item.displayId}</div>
                                            <div className="text-[10px] text-gray-500 mt-1">Size: {item.size}</div>
                                        </div>
                                        <button onClick={() => onRemove(item.cartId)} className="text-gray-300 hover:text-red-500 p-2"><Icon name="trash" size={16} /></button>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    <div className="p-4 bg-white border-t border-gray-100 pb-[calc(20px+env(safe-area-inset-bottom))]">
                        <button 
                            disabled={list.length===0} 
                            onClick={onSend}
                            className="w-full bg-black text-white h-12 rounded text-xs font-bold tracking-wider disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            送出至 LINE
                        </button>
                    </div>
                </div>
            </div>
        );

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>